/*
 * generated by Xtext 2.28.0
 */
package game.of.life.tasks.validation;

import game.of.life.tasks.tASKDSL.TASKDSLPackage
import org.eclipse.xtext.validation.Check;
import game.of.life.tasks.tASKDSL.GridSize;
import game.of.life.tasks.tASKDSL.StartGrid
import game.of.life.tasks.tASKDSL.Cell
import java.util.List
import game.of.life.tasks.tASKDSL.Game

/**
 * This class contains custom validation rules. 
 *
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class TASKDSLValidator extends AbstractTASKDSLValidator {
	

//	public static val INVALID_NAME = 'invalidName'
//
//	@Check
//	def checkGreetingStartsWithCapital(Greeting greeting) {
//		if (!Character.isUpperCase(greeting.name.charAt(0))) {
//			warning('Name should start with a capital', 
//					TASKDSLPackage.Literals.GREETING__NAME,
//					INVALID_NAME)
//		}
//	}
	
	@Check 
	def checkStartGridCoordinates(Game g) //Check if start coordinates are within the grid
	{ 
	    var gs = g.gridSize;
	    var sg =g.startGrid ;
	    for(var i=0; i<sg.size;i++)
	    {
		    var height = gs.get(0).h; //grid size is set in the begining of game and it stays fixed for that game
		    var length = gs.get(0).l;
		    
		    if((sg.get(i).getXC())>=height || (sg.get(i).getXC())<0)
		    	{
		    		error("X axis out of grid",null);	
		    	}
		    if((sg.get(i).getYC())>=length || (sg.get(i).getYC())<0)
		    	{
		    		error("Y axis out of grid",null);
		    	}
	    
	    } 
	}
	
	
	@Check 
	def checkCellCoordinates(Game g) //Check if Cell Coordinates within the grid
	{ 
		var gs = g.gridSize;
	    var c =g.allCells ;
	    
	    for(var i=0; i<gs.size;i++)
	    {
		    var height = gs.get(i).h;
		    var length = gs.get(i).l;
		    
		    for(var j=0; i<c.size;i++)
	    	{
	    	if((c.get(i).getX())>height || ((c.get(i).getX())<0))
	    	{
	    		error("X axis out of grid",null);
	    	}
	    	if(( c.get(i).getY())>length || ((c.get(i).getY())<0))
	    	{
	    		error("Y axis out of grid",null);
	    	}
	    	}
	    } 

	}
	
	@Check 
	def checkCellStatus(Game g) //Check if NextAvailable Action for the State According to Neighbor Number is correct
	{ 
		var c =g.allCells ; 
	    for(var i=0; i<c.size;i++)
	    {
	    	//Cell Status=0 -> Cell is dead
	    	//Cell Status=1 -> Cell is live
	    	if (((c.get(i).getNNo())==3) && (( c.get(i).getS())==0) )  
	    	{
	    		//If Cell is dead and Neighbour No is exactly 3 -> Cell must birth
	    		if((c.get(i).getAvAction().getBirth())!=1)
	    		{
		    		error("Item's next available action is birth!",null);
	    		}
	    		if(( c.get(i).getAvAction().getOvercrowd())==1)
	    		{
		    		error("Death by Overcrowing is not available for this item ! Try changing to birth!",null);
	    		}
	    		if((c.get(i).getAvAction().getSur())==1)
	    		{
		    		error("Survival is not available for this item ! Try changing to birth!",null);
	    		}
	    		if((c.get(i).getAvAction().getXiso())==1)
	    		{
		    		error("Death by Isolation is not available for this item ! Try changing to birth!",null);
	    		}
	    	}
	    	
	    	if(((c.get(i).getNNo())<2) && ((c.get(i).getS())==1)) 
	    	{
	    		//If Cell is live and Neighbour No <1 ->  Cell must die because of isolation
	    		if(( c.get(i).getAvAction().getXiso())!=1)
	    		{
		    		error("Item's next available action is death by isolation!",null);
	    		}
	    		if((c.get(i).getAvAction().getOvercrowd())==1)
	    		{
		    		error("Death by Overcrowing is not available for this item ! Try changing to death by isolation!",null);
	    		}
	    		if((c.get(i).getAvAction().getSur())==1)
	    		{
		    		error("Survival is not available for this item ! Try changing to death by isolation!",null);
	    		}
	    		if(( c.get(i).getAvAction().getBirth())==1)
	    		{
		    		error("Birth is not available for this item ! Try changing to death by isolation!",null);
	    		}
	    	}
	    	
	    	if(((c.get(i).getNNo())>3) && (( c.get(i).getS())==1)) 
	    	{
	    		//If Cell is live and Neighbour No >4 -> Cell must die because of overcrowding
	    		if((c.get(i).getAvAction().getOvercrowd())!=1)
	    		{
		    		error("Item's next available action is death by overcrowding!",null);
	    		}
	    		if((c.get(i).getAvAction().getXiso())==1)
	    		{
		    		error("Death by isolation is not available for this item ! Try changing to death by overcrowding!",null);
	    		}
	    		if((c.get(i).getAvAction().getSur())==1)
	    		{
		    		error("Survival is not available for this item ! Try changing to death by overcrowding!",null);
	    		}
	    		if((c.get(i).getAvAction().getBirth())==1)
	    		{
		    		error("Birth is not available for this item ! Try changing to death by overcrowding!",null);
	    		}
	    	}
	    	if(((c.get(i).getNNo())==2) || (( c.get(i).getNNo())==3) && ((c.get(i).getS())==1)) 
	    	{
	    		//If Cell is live and Neighbour No ==2 or Neighbour No==3 -> Cell must survive
	    		if((c.get(i).getAvAction().getSur())!=1)
	    		{
		    		error("Item's next available action is survival!",null);
	    		}
	    		if((c.get(i).getAvAction().getXiso())==1)
	    		{
		    		error("Death by isolation is not available for this item ! Try changing to survival!",null);
	    		}
	    		if((c.get(i).getAvAction().getOvercrowd())==1)
	    		{
		    		error("Death by overcrowding is not available for this item ! Try changing to survival!",null);
	    		}
	    		if((c.get(i).getAvAction().getBirth())==1)
	    		{
		    		error("Birth is not available for this item ! Try changing to survival!",null);
	    		}
	    	}    	
	    }
	}
	
	@Check 
	  def checkDoubleCoordinates(Game g){ //Do not allow 2 different specifications for the same coordinate
	    var plist = planning.persons // lists start at position 0 
	    for (var i= 0; i < plist.size ; i++){ 
	      for (var j = i+1; j < plist.size ; j++){ 
	        if (plist.get(i).name.equals(plist.get(j).name)) { 
	            error("Double name",null) 
	        } 
	      } 
	    } 
	    
	 
  } 
	
	
}

